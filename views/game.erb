<% if game_organizer?(@game.id, session[:player_id]) %>
  <form class="inline" method="post" action="/games/<%= @game.id %>/delete">
      <button type="submit">Delete game</button>
    </form>
<% end %>

<h2>
  🕔 <%= DAYS_OF_WEEK[@game.start_time.wday] %>, <%= MONTHS[@game.start_time.month - 1] %> <%= @game.start_time.day %>
</h2>

<h2>
  🌎 <%= @game.location_name %>
</h2>

<br>

<h3>
  <a class="orange-link" href="/groups/<%= @game.group_id %>">
    <%= @game.group_name %>
  </a>
</h3>

<p>
  <br>
  Attendees: <%= @game.filled_slots %> / <%= @game.total_slots %>
  <br>
  Fee: $<%= @game.fee %>
  <br>
</p>

<p>
  <%= @game.notes %>
</p>

<p>
  <% if session[:logged_in] && game_organizer?(@game.id, session[:player_id]) %>
      <form class="inline" method="post" action="/games/<%= @game.id %>/players/confirm_all">
        <button type="submit">Confirm All</button>
      </form>
      <form class="inline" method="post" action="/games/<%= @game.id %>/players/unconfirm_all">
        <button type="submit">Un-confirm All</button>
      </form>
  <% end %>
</p>

<table>
  <tr>
    <th>Name</th>
    <th><a class="orange-link" href="https://www.dropbox.com/s/vmk48yybqhd35dj/rr-rating-reformatted.pdf?dl=0">Rating</a></th>
    <th>Paid?</th>
    <th><!-- Confirm / Un-confirm col --></th>
    <th><!-- Remove col --></th>
  </tr>

  <% @game.players.each do |player| %>
  <tr>
    <td align="center">
      <% unless player.username.nil? %>
        <a class="orange-link" href="/players/<%= player.id %>">
      <% end %>
          <%= player.name %>
      <% unless player.username.nil? %>
        </a>
      <% end %>
    </td>

    <td align="center"><%= player.rating %></td>

    <td align="center">
      <% if player.fee_paid %>
        ✅
      <% else %>
        ❌
      <% end %>
    </td>

    <td>
      <% if session[:logged_in] && game_organizer?(@game.id, session[:player_id]) && player.fee_paid %>
        <form class="inline" method="post" action="/games/<%= @game.id %>/players/<%= player.id %>/unconfirm_paid">
          <button type="submit">Un-confirm</button>
        </form>
      <% end %>

      <% if session[:logged_in] && game_organizer?(@game.id, session[:player_id]) && !player.fee_paid %>
        <form class="inline" method="post" action="/games/<%= @game.id %>/players/<%= player.id %>/confirm_paid">
          <button type="submit">Confirm</button>
        </form>
      <% end %>
    </td>

    <td>
      <% if session[:logged_in] && game_organizer?(@game.id, session[:player_id]) %>
        <form class="inline" method="post" action="/games/<%= @game.id %>/players/<%= player.id %>/remove">
          <button type="submit">Remove</button>
        </form>
      <% end %>
    </td>
  </tr>
  <% end %>
</table>

<br>

<% unless @game.filled_slots >= @game.total_slots %>
  <form action="/games/<%= @game_id %>/players/add" method="post">
    <% unless session[:logged_in] %>
      <dl>
        <dt>
          <label for="player_name">Sign up for this game:</label>
        </dt>
        <dd>
          <input name="player_name" placeholder="Your name" type="text">
        </dd>
      </dl>
    <% end %>

    <% if session[:logged_in] && !already_signed_up?(@game_id, session[:player_id]) %>
      <button type="submit">Sign up</button>
    <% end %>
  </form>

  <% if session[:logged_in] && already_signed_up?(@game_id, session[:player_id]) %>
    <form class="inline" method="post" action="/games/<%= @game.id %>/players/remove">
      <button type="submit">Remove me</button>
    </form>
  <% end %>

  <p>
    <% unless session[:logged_in] %>
      <a class="orange-link" href="/register">Register an account to manage your RSVP.</a>
    <% end %>
  </p>
<% end %>

<% content_for :login_links do %>
  <% if session[:logged_in] %>
    <em>Signed in as <%= session[:username] %></a></em>
    <form class="inline" method="post" action="/logout">
      <button type="submit">Sign Out</button>
    </form>
  <% else %>
    <form method="get" action="/login">
      <button type="submit">Sign In</button>
    </form>
  <% end %>
<% end %>

<% content_for :header_links do %>
  <ul>
    <li>
      <a href="/game_list">🏸 Games</a>
    </li>

    <li>
      <a href="/group_list">👥 Groups</a>
    </li>

    <% if session[:logged_in] %>
      <li>
        <a href="/players/<%= session[:player_id] %>">👤 Profile</a>
      </li>
    <% end %>
  </ul>
<% end %>
